function P(r,p,E){if(r.length<=p)return r;let d=[];d.push(r[0]);for(let l=1;l<r.length-1;l++){let w=Math.max(2,Math.floor(p*Math.pow(r[l].x/E,2)*3)),o=Math.floor(w/2),e=Math.max(0,l-o),k=Math.min(r.length-1,l+o),s=0;for(let h=e;h<=k;h++)s+=r[h].y;let g=s/(k-e+1);d.push({x:r[l].x,y:g})}return r.length>1&&d.push(r[r.length-1]),d}var R=null,z=null;function B(){return R}function H(){return z}function he(r){let p=r.pre||[],E=r.mid||[],d=r.post||[],l=r.minDecibels||-100,w=r.maxDecibels||-25,o=document.getElementById("visual"),e=null;if(o instanceof HTMLCanvasElement){if(e=o.getContext("2d"),!e)throw new Error("Critical: Canvas context not found or 'visual' element is not a canvas.")}else throw new Error("Critical: 'visual' element is not a canvas.");let k=p.length,s=document.body.classList.contains("dark-mode");e.clearRect(0,0,o.width,o.height),e.fillStyle=s?"#121212":"#fefefe",e.fillRect(0,0,o.width,o.height);let g=t=>(Math.max(l,Math.min(w,t))-l)/(w-l);e.fillStyle=s?"#aaaaaa":"#aaa",e.font="10px Arial";let h=[30,60,120,250,500,1e3,2e3,4e3,8e3,17e3];h.forEach((t,i)=>{let c=Math.log2(t/20),b=Math.log2(17e3/20),n=c/b*o.width;if(i<h.length-1){let y=1-i/(h.length-1);n+=10*y}e.strokeStyle=s?"#333333":"#ddd",e.lineWidth=1,e.beginPath(),e.moveTo(n,0),e.lineTo(n,o.height),e.stroke(),e.fillStyle=s?"#e0e0e0":"#333",e.fillText(t>=1e3?`${t/1e3}k`:t.toString(),n-10,o.height-5)}),[-90,-80,-70,-60,-50,-40,-30].forEach(t=>{let i=o.height-g(t)*o.height;e.strokeStyle=s?"#333333":"#eee",e.beginPath(),e.moveTo(0,i),e.lineTo(o.width,i),e.stroke(),e.fillStyle=s?"#e0e0e0":"#333",e.fillText(`${t} dB`,5,i+12)});let F=[],L=[],S=[];for(let t=0;t<k;t++){let b=t/k*22050;if(b>17e3)break;if(b<20)continue;let n=Math.log2(b/20),y=Math.log2(17e3/20),x=n/y*o.width*.995;if(t<p.length){let a=o.height-g(p[t])*o.height;F.push({x,y:a})}if(t<E.length){let a=o.height-g(E[t])*o.height;L.push({x,y:a})}if(t<d.length){let a=o.height-g(d[t])*o.height;S.push({x,y:a})}}let m=P(F,7,o.width),u=P(L,7,o.width),f=P(S,7,o.width);if(e.shadowBlur=10,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowColor="rgba(190, 90, 255, 0.4)",e.strokeStyle="rgba(190, 90, 255, 0.8)",e.fillStyle="rgba(190, 90, 255, 0.3)",e.lineWidth=2,e.beginPath(),e.moveTo(0,o.height),m.forEach(t=>{e.lineTo(t.x,t.y)}),e.lineTo(o.width,o.height),e.closePath(),e.fill(),e.beginPath(),m.length>0){e.moveTo(m[0].x,m[0].y);for(let t=1;t<m.length;t++)e.lineTo(m[t].x,m[t].y);e.stroke()}if(e.shadowColor="rgba(255, 180, 50, 0.4)",e.strokeStyle="rgba(255, 180, 50, 0.8)",e.fillStyle="rgba(255, 180, 50, 0.3)",e.beginPath(),e.moveTo(0,o.height),u.forEach(t=>{e.lineTo(t.x,t.y)}),e.lineTo(o.width,o.height),e.closePath(),e.fill(),e.beginPath(),u.length>0){e.moveTo(u[0].x,u[0].y);for(let t=1;t<u.length;t++)e.lineTo(u[t].x,u[t].y);e.stroke()}if(e.shadowColor="rgba(50, 220, 120, 0.4)",e.strokeStyle="rgba(50, 220, 120, 0.8)",e.fillStyle="rgba(50, 220, 120, 0.3)",e.beginPath(),e.moveTo(0,o.height),f.forEach(t=>{e.lineTo(t.x,t.y)}),e.lineTo(o.width,o.height),e.closePath(),e.fill(),e.beginPath(),f.length>0){e.moveTo(f[0].x,f[0].y);for(let t=1;t<f.length;t++)e.lineTo(f[t].x,f[t].y);e.stroke()}e.shadowBlur=0,e.shadowColor="transparent";let v=20,M=120;e.fillStyle="rgba(190, 90, 255, 0.8)",e.fillRect(10,v-10,10,10),e.fillStyle=s?"#e0e0e0":"#333",e.fillText("Pre-EQ",25,v),e.fillStyle="rgba(255, 180, 50, 0.8)",e.fillRect(10+M,v-10,10,10),e.fillStyle=s?"#e0e0e0":"#333",e.fillText("Post-Filtros",25+M,v),e.fillStyle="rgba(50, 220, 120, 0.8)",e.fillRect(10+M*2,v-10,10,10),e.fillStyle=s?"#e0e0e0":"#333",e.fillText("Post-Compresor",25+M*2,v);let T=B(),C=H();if(T){let t=Math.log2(T/20),i=Math.log2(17e3/20),c=t/i*o.width*.995;if(e.lineWidth=2,e.strokeStyle="#ff3366",e.beginPath(),e.moveTo(c,0),e.lineTo(c,o.height),e.stroke(),e.fillStyle="#ff3366",e.font="12px Arial",e.fillText(`${T} Hz`,c+5,15),C){e.beginPath(),e.strokeStyle="rgba(255, 51, 102, 0.7)",e.fillStyle="rgba(255, 51, 102, 0.2)";let b=Math.max(20,200/C);e.beginPath();let n=[],y=c,x=o.height*.7;for(let a=-o.width/2;a<=o.width/2;a+=5){let I=y+a;if(I>=0&&I<=o.width){let A=20*Math.pow(10,I/o.width*Math.log10(850))/T,N=1/Math.sqrt(1+Math.pow(C*(A-1/A),2)),D=o.height-x*N;n.push({x:I,y:D})}}if(n.length>0){e.beginPath(),e.moveTo(n[0].x,n[0].y);for(let a=1;a<n.length;a++)e.lineTo(n[a].x,n[a].y);e.stroke(),e.lineTo(n[n.length-1].x,o.height),e.lineTo(n[0].x,o.height),e.closePath(),e.fill(),e.fillStyle="#ff3366",e.fillText(`Q: ${C.toFixed(1)}`,c+5,30)}}}}export{he as drawVisualizer};
//# sourceMappingURL=visualizer.js.map
